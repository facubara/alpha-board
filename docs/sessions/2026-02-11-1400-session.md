# Session: 2026-02-11 14:00

**Goal**: Add 28 rule-based Python trading agents (no LLM) alongside existing 28 LLM agents, with engine filter on leaderboard
**Agent Roles**: Bash

## Model Settings

| Setting | Value | Description |
|---------|-------|-------------|
| Subagent Model | `inherit` | Model for subagent tasks: `inherit`, `haiku`, `sonnet`, `opus` |

*`inherit` = use conversation model. Use `haiku` for cost savings on bounded tasks.*

---

## Work Summary

Added 28 rule-based Python trading agents that execute deterministic if/else strategy logic with zero API calls. Implemented 8 strategy classes (4 base archetypes + 4 cross-TF) mirroring the exact entry/exit rules from LLM agent prompts, a RuleBasedExecutor that produces identical AgentDecisionResult output, engine branching in the orchestrator, and full frontend support with an engine filter on the leaderboard.

## Files Changed

### Created
- `worker/alembic/versions/004_add_engine_column.py` — Migration: add engine column to agents
- `worker/alembic/versions/005_seed_rule_based_agents.py` — Seed 28 rule-based agents
- `worker/src/agents/strategies/__init__.py` — Strategy registry
- `worker/src/agents/strategies/base.py` — Base rule strategy class
- `worker/src/agents/strategies/momentum.py` — Momentum strategy rules
- `worker/src/agents/strategies/mean_reversion.py` — Mean reversion strategy rules
- `worker/src/agents/strategies/breakout.py` — Breakout strategy rules
- `worker/src/agents/strategies/swing.py` — Swing strategy rules
- `worker/src/agents/strategies/cross_confluence.py` — Cross-TF confluence rules
- `worker/src/agents/strategies/cross_divergence.py` — Cross-TF divergence rules
- `worker/src/agents/strategies/cross_cascade.py` — Cross-TF cascade rules
- `worker/src/agents/strategies/cross_regime.py` — Cross-TF regime detection rules
- `worker/src/agents/rule_executor.py` — Rule-based executor (replaces Claude API)

### Modified
- `worker/src/models/db.py` — Add engine column to Agent model
- `worker/src/agents/orchestrator.py` — Branch on engine type
- `worker/src/agents/context.py` — Add symbol_tf_scores to confluence data
- `web/src/lib/types.ts` — Add AgentEngine type
- `web/src/lib/queries/agents.ts` — Add engine to SQL queries
- `web/src/components/agents/agent-leaderboard.tsx` — Add engine filter
- `web/src/components/agents/agent-row.tsx` — Add engine badge
- `web/src/components/agents/agent-detail.tsx` — Add engine badge + conditional tabs

### Deleted
- None

## Decisions Made

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Engine distinction | `engine` column on agents table | Simple, filterable, no schema bloat |
| Rule-based naming | `rb-{archetype}-{tf}` | Clear prefix distinguishes from LLM agents |
| Strategy pattern | One class per archetype with registry | Testable, discoverable, extensible |
| Skip memory/evolution | Guard in orchestrator | Rule agents have fixed logic, no LLM calls |
| model_used marker | "rule_engine" | Makes rule decisions identifiable in DB |

## Security Checklist

- [x] No hardcoded secrets (API keys, passwords, tokens)
- [x] All data is synthetic (no real customer/company data)
- [x] No proprietary algorithms exposed (using stubs)
- [x] Environment variables used for configuration

## Commit Message

```
feat(agents): add 28 rule-based Python trading agents

- Add engine column to agents table (llm/rule)
- Implement 8 strategy classes mirroring LLM prompt rules
- Add RuleBasedExecutor producing same AgentDecisionResult
- Branch orchestrator on engine type, skip memory/evolution for rule agents
- Seed 28 rule-based agents with $10K portfolios
- Add engine filter (LLM/Rule/All) to frontend leaderboard
- Add engine badge to agent rows and detail pages

Session: docs/sessions/2026-02-11-1400-session.md
Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
```

## Next Steps

- [ ] Deploy updated worker + frontend
- [ ] Monitor rule-based agent decisions in production
- [ ] Compare LLM vs rule-based performance after data accumulates

## Notes

- All 8 strategy classes mirror the exact entry/exit rules from the LLM agent prompts in seed data
- Cross-TF strategies required enhancing context.py to expose `symbol_tf_scores`
- Rule agents skip memory generation and prompt evolution (no LLM calls)
- `model_used="rule_engine"` with zero token costs in all decision records

---
*Session ended: 2026-02-11 16:30*
