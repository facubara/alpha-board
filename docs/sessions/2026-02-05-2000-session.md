# Session: 2026-02-05 20:00

**Goal**: Phase 10 — Agent Learning & Evolution. Implement memory bank, prompt evolution, auto-revert, and prompt version management.
**Agent Roles**: Bash

## Model Settings

| Setting | Value | Description |
|---------|-------|-------------|
| Subagent Model | `inherit` | Model for subagent tasks: `inherit`, `haiku`, `sonnet`, `opus` |

*`inherit` = use conversation model. Use `haiku` for cost savings on bounded tasks.*

---

## Work Summary

Implemented the complete agent learning and evolution system. Created MemoryManager for generating trade reflections via Claude API (using scan_model for cost efficiency), with auto-tagging of memories by symbol, outcome, direction, exit reason, PnL magnitude, and duration. Created EvolutionManager for automatic prompt evolution after N trades, including diff generation between prompt versions and auto-revert logic when PnL drops >20% after evolution. Integrated both systems into the orchestrator to generate memories after each closed trade and trigger evolution checks. All 145 tests pass.

## Files Changed

### Created
- `docs/sessions/2026-02-05-2000-session.md` — This session file
- `worker/src/agents/memory.py` — MemoryManager for trade reflections
- `worker/src/agents/evolution.py` — EvolutionManager for prompt evolution
- `worker/tests/test_evolution.py` — Tests for memory and evolution

### Modified
- `worker/src/agents/__init__.py` — Export new classes
- `worker/src/agents/orchestrator.py` — Memory + evolution integration
- `worker/src/agents/context.py` — Memory injection already present

### Deleted
- None

## Decisions Made

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Memory model | scan_model (Haiku) | Cost-efficient for simple reflections |
| Evolution model | evolution_model (Opus) | Higher quality for strategy improvements |
| Auto-revert threshold | 20% PnL drop | Balance between patience and protection |
| Revert evaluation period | 5 trades | Enough data to assess trend |
| Memory tags | 6 categories | Symbol, outcome, direction, exit, magnitude, duration |
| Evolution trigger | Per-agent configurable | Default 10 trades |

## Security Checklist

- [x] No hardcoded secrets (API keys, passwords, tokens)
- [x] All data is synthetic (no real customer/company data)
- [x] No proprietary algorithms exposed
- [x] Environment variables used for configuration (ANTHROPIC_API_KEY)

## Test Results

| Module | Tests | Result |
|--------|-------|--------|
| Exchange | 10 | PASS |
| Indicators | 47 | PASS |
| Scoring | 23 | PASS |
| Pipeline | 17 | PASS |
| Agents | 27 | PASS |
| Evolution | 21 | PASS |
| **Total** | **145** | **PASS** |

## Commit Message

```
feat(agents): add memory bank and prompt evolution system

- Add MemoryManager for generating trade reflections via Claude
- Add EvolutionManager for automatic prompt evolution
- Add auto-revert logic when PnL drops >20% after evolution
- Add trade threshold tracking for evolution triggers
- Integrate memory and evolution into orchestrator
- Add tests for evolution system

Session: docs/sessions/2026-02-05-2000-session.md
Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```

**Commit types**: feat, fix, docs, refactor, test, chore

## Next Steps

- [ ] Phase 11: Agent Leaderboard (frontend)

## Notes

- Memory is generated after each trade closes using scan_model (Haiku)
- Evolution triggers after N closed trades (configurable per-agent)
- Auto-revert if PnL drops >20% within 5 trades after evolution
- Memory includes auto-tagging with symbol, outcome, strategy labels

---
*Session ended: 2026-02-05*
